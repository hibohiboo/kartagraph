
[[_TOC_]]

## シナリオ開始処理

1. 現在の状態を復元できる情報を保存
1. 新しいシナリオを読込
1. シナリオスタート
1. 最初のイベントデッキ
1. 最初のイベント
1. コマンドを順番に処理

## イベントデッキ
イベントをまとめた単位

## イベント
コマンドをまとめた単位

## コマンド
最小の単位。以下の種類がある

コマンド|説明
--|--
テキスト|文字を表示する。画面クリックによって次のコマンド。
選択肢|選択肢を表示する。
入力待ち|入力待ち状態にする
リンク|次のイベントへ遷移
タグ分岐|パーティのタグを判定して次のコマンド。TODO: キャラクタ判定
タグ取得|パーティ/キャラクターにタグを付与する
タグ廃棄|パーティ/キャラクターからタグを除去する
シナリオ開始|現在のシナリオを開始する
シナリオ終了|シナリオを終了する
キャラクター追加|キャラクターをパーティに追加する
確認|OKで次のイベント、キャンセルで元の状態に戻る

## コマンド実装

### シナリオ開始

1. シナリオが開始できるかのチェック
  ・ シナリオのクリアフラグがあるか
  ・ パーティの人数が適正か
  ・ シナリオの必要タグを所持しているか（シナリオ開始イベントが表示されない）
1. シナリオスタックに現在のシナリオの復元用の情報を入れる
1. 現在のシナリオをクリア。シナリオを開始

### シナリオ終了
1. クリアのタグをＤＢに書き込み
1. ＤＢから集計を読み出し
1. シナリオ終了情報を表示
1. シナリオ限定タグのクリア
1. シナリオスタックから前回のシナリオの状態を復元

### キャラクター追加

1. 初回起動
1. パーティ作成
1. キャラクター作成
